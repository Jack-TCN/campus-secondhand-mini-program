<!-- packageA/pages/publish/publish.wxml -->
<view class="publish-container">
  <van-nav-bar title="{{isEdit ? '编辑商品' : '发布商品'}}" left-arrow bind:click-left="onBack" />
  
  <view class="form">
    <van-field
      label="标题"
      placeholder="请输入商品标题"
      value="{{form.title}}"
      bind:change="onFieldChange"
      data-field="title"
    />
    
    <van-field
      label="价格"  
      placeholder="请输入商品价格"
      value="{{form.price}}"
      type="digit"
      bind:change="onFieldChange"
      data-field="price"
    />
    
    <van-field
      label="原价"
      placeholder="选填，原价"
      value="{{form.originalPrice}}"
      type="digit"
      bind:change="onFieldChange"
      data-field="originalPrice"
    />
    
    <van-field
      label="分类"
      placeholder="请选择分类"
      value="{{categoryText}}"
      readonly
      is-link
      bind:click="showCategoryPicker"
    />
    
    <van-field
      label="新旧"
      placeholder="请选择新旧程度"
      value="{{conditionText}}"
      readonly
      is-link
      bind:click="showConditionPicker"
    />
    
    <view class="desc-field">
      <van-field
        label="描述"
        placeholder="请描述一下你的宝贝（200字以内）"
        value="{{form.desc}}"
        type="textarea"
        autosize="{{ {minHeight: 100} }}"
        bind:input="onDescInput"
      />
      <view class="desc-count {{descLength >= 180 ? 'warning' : ''}}">
        {{descLength}} / 200
      </view>
    </view>
    
    <!-- 图片上传 -->
    <view class="upload-section">
      <text class="upload-title">商品图片（最多9张）</text>
      <view class="image-list">
        <view wx:for="{{form.images}}" wx:key="index" class="image-item">
          <image src="{{item}}" mode="aspectFill" />
          <view class="delete-btn" bind:tap="deleteImage" data-index="{{index}}">
            <van-icon name="cross" color="#fff" size="16px" />
          </view>
        </view>
        <view wx:if="{{form.images.length < 9}}" class="upload-btn" bind:tap="chooseImage">
          <van-icon name="plus" size="24px" color="#999" />
        </view>
      </view>
    </view>
    
    <!-- 联系方式 -->
    <view class="contact-section">
      <text class="section-title">联系方式</text>
      <van-field
        label="微信号"
        placeholder="选填，便于买家联系"
        value="{{form.contactValue}}"
        bind:change="onFieldChange"
        data-field="contactValue"
      />
    </view>
  </view>
  
  <view class="submit-btn">
    <van-button type="primary" block bind:click="submit">
      {{isEdit ? '保存修改' : '立即发布'}}
    </van-button>
  </view>
  
  <!-- 选择器 -->
  <van-popup show="{{showCategory}}" position="bottom">
    <van-picker
      columns="{{categoryColumns}}"
      bind:confirm="onCategoryConfirm"
      bind:cancel="onCategoryCancel"
    />
  </van-popup>
  
  <van-popup show="{{showCondition}}" position="bottom">
    <van-picker
      columns="{{conditionColumns}}"
      bind:confirm="onConditionConfirm"
      bind:cancel="onConditionCancel"
    />
  </van-popup>
</view>
