<!-- pages/detail/detail.wxml -->
<view class="detail-container">
  <van-nav-bar
    title="商品详情"
    left-arrow
    bind:click-left="onBack"
  />

  <view wx:if="{{!loading && product}}">
    <!-- 图片轮播 -->
    <swiper 
      class="image-swiper" 
      indicator-dots 
      indicator-active-color="#667eea"
      current="{{currentImageIndex}}"
      autoplay
      circular
    >
      <swiper-item wx:for="{{product.images}}" wx:key="index">
        <image 
          class="swiper-image" 
          src="{{item}}" 
          mode="aspectFill"
          bind:tap="previewImage"
          data-index="{{index}}"
        />
      </swiper-item>
    </swiper>

    <!-- 商品信息 -->
    <view class="product-info">
      <view class="info-header">
        <text class="title">{{product.title}}</text>
        <view class="price-row">
          <text class="price">¥{{product.price}}</text>
          <text class="original-price" wx:if="{{product.originalPrice}}">
            ¥{{product.originalPrice}}
          </text>
        </view>
      </view>

      <view class="info-tags">
        <van-tag type="primary" plain>{{conditionText}}</van-tag>
        <van-tag plain>{{categoryText}}</van-tag>
        <text class="view-count">浏览 {{product.viewCount || 0}}</text>
      </view>

      <view class="info-desc">
        <text class="desc-title">商品描述</text>
        <text class="desc-content">{{product.desc}}</text>
      </view>

      <!-- 卖家信息 -->
      <view class="seller-info">
        <image class="seller-avatar" src="{{product.userInfo.avatarUrl || '/images/default-avatar.png'}}" />
        <view class="seller-detail">
          <text class="seller-name">{{product.userInfo.nickName || '匿名用户'}}</text>
          <text class="seller-school">{{product.userInfo.school || '暂无学校信息'}}</text>
        </view>
      </view>

      <view class="publish-time">
        发布于 {{createTimeStr}}
      </view>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="bottom-bar">
    <view class="bar-left">
      <button class="icon-btn" bind:tap="toggleFavorite">
        <van-icon name="{{isFavorite ? 'star' : 'star-o'}}" color="{{isFavorite ? '#f60' : '#666'}}" />
        <text>{{isFavorite ? '已收藏' : '收藏'}}</text>
      </button>
      <button class="icon-btn" open-type="share">
        <van-icon name="share-o" />
        <text>分享</text>
      </button>
    </view>
    <van-button 
      type="primary" 
      round 
      bind:click="contactSeller"
      custom-class="contact-btn"
    >
      联系卖家
    </van-button>
  </view>

  <van-loading wx:if="{{loading}}" custom-class="loading" size="24px">
    加载中...
  </van-loading>
</view>